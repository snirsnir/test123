<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>××©×—×§ ×’×“×œ×™× â€“ ×§×˜×Ÿ/×‘×™× ×•× ×™/×’×“×•×œ</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f7fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --primary:#6366f1; --ok:#16a34a; --bad:#dc2626; --amber:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Heebo,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:950px;margin:24px auto;padding:16px}
  .card{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.08);padding:20px}
  h1{margin:0 0 8px;font-weight:800}
  .muted{color:var(--muted)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .row > *{flex:0 0 auto}
  select,button,input[type="number"]{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;font-size:16px;background:#fff}
  button{cursor:pointer}
  button.primary{background:var(--primary);color:#fff;border-color:transparent;font-weight:700}
  button.ghost{background:#fff}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .pill{padding:8px 12px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700;display:inline-block}
  .area{height:340px;border:2px dashed #e2e8f0;border-radius:16px;display:flex;align-items:center;justify-content:center;position:relative;background:#fafafa}
  .stimulus{user-select:none;}
  .stimulus .char{display:inline-block;line-height:1}
  .size-small .char{font-size:48px}
  .size-medium .char{font-size:96px}
  .size-large .char{font-size:144px}
  .feedback{position:absolute;top:10px;left:10px;font-size:22px;font-weight:800}
  .feedback.ok{color:var(--ok)}
  .feedback.bad{color:var(--bad)}
  .stats{display:flex;gap:16px;flex-wrap:wrap}
  .stat{background:#f8fafc;border-radius:12px;padding:10px 12px}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#111827;color:#fff;border-radius:6px;padding:2px 6px;font-size:14px}
  .footer{color:var(--muted);font-size:14px;margin-top:8px}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>××©×—×§ ×’×“×œ×™× â€“ ×§×˜×Ÿ / ×‘×™× ×•× ×™ / ×’×“×•×œ</h1>
      <p class="muted">×”×™×œ×“/×” ×œ×•×—×¥/×ª ×›×©××•×¤×™×¢×” ×“××•×ª ×‘×’×•×“×œ ×”××‘×•×§×©. ×”××—×©×‘ × ×•×ª×Ÿ ××©×•×‘ ××™×“×™ âœ”ï¸/âœ–ï¸ ×•××—×©×‘ ×ª×•×¦××•×ª.</p>

      <div class="row" style="margin-top:6px;margin-bottom:12px">
        <label>×’×•×“×œ ××˜×¨×”: 
          <select id="targetSize">
            <option value="small">×§×˜×Ÿ</option>
            <option value="medium" selected>×‘×™× ×•× ×™</option>
            <option value="large">×’×“×•×œ</option>
          </select>
        </label>
        <label>××¡×³ × ×¡×™×•× ×•×ª: <input id="trials" type="number" min="5" max="200" value="24"/></label>
        <label>××©×š ×’×™×¨×•×™ (××´×©): <input id="stimMs" type="number" min="300" max="5000" step="100" value="1200"/></label>
        <label>×”×¤×¡×§×” ×‘×™×Ÿ ×’×™×¨×•×™×™× (××´×©): <input id="isiMs" type="number" min="200" max="4000" step="100" value="700"/></label>
        <button id="startBtn" class="primary">×”×ª×—×œ/×™ ××©×—×§</button>
        <button id="stopBtn" class="ghost">×¢×¦×•×¨</button>
        <span class="pill">×œ×—×¦×Ÿ: <span class="kbd">×¨×•×•×—</span> ××• ×”×§×œ×§×”</span>
      </div>

      <div id="arena" class="area" tabindex="0">
        <div id="feedback" class="feedback hidden"></div>
        <div id="stimulus" class="stimulus size-medium hidden" aria-live="polite">
          <span class="char" id="char">ğŸ§¸</span>
        </div>
      </div>

      <div class="row" style="margin-top:14px;justify-content:space-between">
        <div class="stats">
          <div class="stat">× ×›×•× ×•×ª: <b id="acc">0/0</b></div>
          <div class="stat">×”×—××¦×•×ª: <b id="miss">0</b></div>
          <div class="stat">××–×¢×§×•×ª ×©×•×•×: <b id="fa">0</b></div>
          <div class="stat">×–××Ÿ ×ª×’×•×‘×” ×××•×¦×¢: <b id="rt">â€“</b></div>
        </div>
        <div class="footer">×˜×™×¤: ×× ×™×© ×œ×š ×‘×–×–×¨ ×©××–×“×”×” ×›××§×œ×“×ª (×›××• USB buzzer) â€“ ××¤×©×¨ ×œ××¤×•×ª ××•×ª×• ×œ<span class="kbd">×¨×•×•×—</span>.</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>××™×š ×–×” ×¢×•×‘×“</h2>
      <ol>
        <li>×‘×—×¨/×™ ×’×•×“×œ ××˜×¨×” (×§×˜×Ÿ/×‘×™× ×•× ×™/×’×“×•×œ).</li>
        <li>×œ×—×¦/×™ <b>×”×ª×—×œ/×™ ××©×—×§</b>. ×‘×›×œ × ×™×¡×™×•×Ÿ ××•×¤×™×¢×” ×“××•×ª ×‘×’×•×“×œ ××§×¨××™.</li>
        <li>×× ×”×’×•×“×œ ×ª×•×× ×œ××˜×¨×” â€“ ×œ×—×¦/×™ <span class="kbd">×¨×•×•×—</span> (××• ×”×§×œ×§/×™ ×‘××–×•×¨). ×× ×œ× â€“ ××œ ×ª×œ×—×¦×•.</li>
        <li>×ª×§×‘×œ/×™ ××©×•×‘ ××™×“×™ âœ”ï¸/âœ–ï¸. ×‘×¡×™×•× ××•×¦×’×ª ×ª××¦×™×ª ×‘×™×¦×•×¢×™×.</li>
      </ol>
    </div>
  </div>

  <audio id="sndOk">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBAGZmZmZm" type="audio/wav">
  </audio>
  <audio id="sndBad">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBAGZmZmZm" type="audio/wav">
  </audio>

<script>
(() => {
  const arena = document.getElementById('arena');
  const stimEl = document.getElementById('stimulus');
  const charEl = document.getElementById('char');
  const feedback = document.getElementById('feedback');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const targetSel = document.getElementById('targetSize');
  const trialsInput = document.getElementById('trials');
  const stimMsInput = document.getElementById('stimMs');
  const isiMsInput = document.getElementById('isiMs');
  const accEl = document.getElementById('acc');
  const missEl = document.getElementById('miss');
  const faEl = document.getElementById('fa');
  const rtEl = document.getElementById('rt');
  const sndOk = document.getElementById('sndOk');
  const sndBad = document.getElementById('sndBad');

  const CHARS = ['ğŸ§¸','ğŸ¦Š','ğŸ¼','ğŸ¯','ğŸ¦„','ğŸ¶','ğŸ±','ğŸ¹'];
  const SIZES = ['small','medium','large'];

  let running = false, trial = 0, trials = 24;
  let target = 'medium', stimMs = 1200, isiMs = 700;
  let currSize = 'medium', shownAt = 0, responded = false;
  let hits = 0, misses = 0, fas = 0, rts = [];
  let timer1, timer2;

  function resetStats(){ trial=0; hits=0; misses=0; fas=0; rts=[]; updateStats(); }
  function updateStats(){ accEl.textContent = `${hits}/${trial}`; missEl.textContent = misses; faEl.textContent = fas; rtEl.textContent = rts.length? `${Math.round(rts.reduce((a,b)=>a+b,0)/rts.length)} ×"×©` : 'â€“'; }

  function randomPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function setStimSize(sz){ stimEl.classList.remove('size-small','size-medium','size-large'); stimEl.classList.add(`size-${sz}`); }

  function showFeedback(ok){
    feedback.textContent = ok? 'âœ”ï¸ × ×›×•×Ÿ' : 'âœ–ï¸ ×˜×¢×•×ª';
    feedback.classList.remove('hidden','ok','bad');
    feedback.classList.add(ok? 'ok':'bad');
    (ok? sndOk : sndBad).currentTime=0; (ok? sndOk : sndBad).play().catch(()=>{});
    clearTimeout(timer2);
    timer2 = setTimeout(()=> feedback.classList.add('hidden'), 450);
  }

  function nextTrial(){
    if(!running) return;
    if(trial >= trials){ finish(); return; }
    responded = false;
    currSize = Math.random()<0.5 ? target : randomPick(SIZES); // ~50% ××˜×¨×”
    if(Math.random()<0.33) currSize = randomPick(SIZES); // ×¢×•×“ ×¢×™×¨×‘×•×‘ ×§×œ
    charEl.textContent = randomPick(CHARS);
    setStimSize(currSize);
    stimEl.classList.remove('hidden');
    shownAt = performance.now();
    trial++;
    updateStats();
    clearTimeout(timer1);
    timer1 = setTimeout(()=>{ // ×¡×•×£ ×”×’×™×¨×•×™
      stimEl.classList.add('hidden');
      if(!responded && currSize===target){ misses++; updateStats(); }
      // ISI
      setTimeout(nextTrial, isiMs);
    }, stimMs);
  }

  function start(){
    if(running) return;
    target = targetSel.value; trials = +trialsInput.value||24; stimMs=+stimMsInput.value||1200; isiMs=+isiMsInput.value||700;
    running = true; resetStats(); arena.focus(); nextTrial();
  }
  function stop(){ running=false; clearTimeout(timer1); clearTimeout(timer2); stimEl.classList.add('hidden'); }
  function finish(){ running=false; stimEl.classList.add('hidden');
    const total = hits+misses+fas;
    const acc = total? Math.round((hits/(hits+misses))*100):0;
    feedback.textContent = `×¡×™×•×: ×“×™×•×§ ${acc}% | ×¤×’×™×¢×•×ª ${hits} | ×”×—××¦×•×ª ${misses} | ××–×¢×§×•×ª ×©×•×•× ${fas}`;
    feedback.classList.remove('hidden','bad'); feedback.classList.add('ok');
  }

  function handleResponse(){
    if(!running || responded) return;
    responded = true;
    const rt = Math.max(0, Math.round(performance.now()-shownAt));
    const isTargetNow = (currSize === target);
    if(isTargetNow){ hits++; rts.push(rt); showFeedback(true); }
    else { fas++; showFeedback(false); }
    updateStats();
  }

  // Events
  startBtn.addEventListener('click', start);
  stopBtn.addEventListener('click', stop);
  arena.addEventListener('click', handleResponse);
  window.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); handleResponse(); }});
})();
</script>
</body>
</html>
